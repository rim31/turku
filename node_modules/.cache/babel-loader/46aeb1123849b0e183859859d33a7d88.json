{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rims/Documents/musicuizz/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rims/Documents/musicuizz/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/rims/Documents/musicuizz/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";// eslint-disable-next-line\nimport*as React from'react';import moment from'moment';import _ from'lodash';import{createContainer}from\"unstated-next\";import axios from'axios';// const URL_PAGE = `https://api.turku.fi/linkedevents/v1/image/?page=`;\n// source : \"https://api.covid19api.com/\"\nexport var useStore=function useStore(){var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),data=_React$useState2[0],setData=_React$useState2[1];// data for graph\nvar _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),dataDiff=_React$useState4[0],setDataDiff=_React$useState4[1];// data diff for graph\nvar _React$useState5=React.useState([]),_React$useState6=_slicedToArray(_React$useState5,2),labels=_React$useState6[0],setLabels=_React$useState6[1];var _React$useState7=React.useState(\"https://api.turku.fi/linkedevents/v1/event/?page=1\"),_React$useState8=_slicedToArray(_React$useState7,2),eventUrl=_React$useState8[0],setEventUrl=_React$useState8[1];var _React$useState9=React.useState([]),_React$useState10=_slicedToArray(_React$useState9,2),events=_React$useState10[0],setEvents=_React$useState10[1];var _React$useState11=React.useState(\"\"),_React$useState12=_slicedToArray(_React$useState11,2),nextEvents=_React$useState12[0],setNextEvents=_React$useState12[1];var _React$useState13=React.useState(\"\"),_React$useState14=_slicedToArray(_React$useState13,2),previousEvents=_React$useState14[0],setPreviousEvents=_React$useState14[1];var headers=new Headers({\"Accept\":\"application/json\",\"Content-Type\":\"application/json\",\"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:78.0) Gecko/20100101 Firefox/78.0\"});var fetchEventsUrl=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(url?url:eventUrl);case 2:response=_context.sent;setEvents(response.data.data);if(response.data.meta.next)setNextEvents(response.data.meta.next);if(response.data.meta.previous)setPreviousEvents(response.data.meta.previous);console.log(\"Response events unstated\",response.data);return _context.abrupt(\"return\",response.data);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchEventsUrl(_x){return _ref.apply(this,arguments);};}();function countryDataGraph(data,country,caseType,dateTo){var resultCases=[];var resultDates=[];if(data.length>0){data.forEach(function(item){if(moment(item.Date).isAfter(dateTo)){resultCases.push(item.Cases);resultDates.push(moment(item.Date).format('YYYY/MM/DD'));}});var resultCasesDiff=_.map(resultCases,function(e,i){return resultCases[i+1]-e<0?0:resultCases[i+1]-e;});resultCasesDiff.pop();resultCases.pop();resultDates.pop();setDataDiff(resultCasesDiff);setData(resultCases);setLabels(resultDates);}}// const response = await fetch(\"https://sampo.thl.fi/pivot/prod/en/epirapo/covid19case/fact_epirapo_covid19case.json\", {\nvar getDataCovid=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var country,caseType,dateTo;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;country='finland';caseType='confirmed';dateTo=\"\".concat(moment().subtract(3,'months').format());_context2.next=6;return fetch(\"https://api.covid19api.com/country/\".concat(country,\"/status/\").concat(caseType,\"/live?from=\").concat(dateTo,\"&to=\").concat(moment().format('YYYY-MM-DDT00:00:00')),{method:'GET',redirect:'follow',headers:headers}).then(function(response){return response.json();}).then(function(res){countryDataGraph(res,country,caseType,dateTo);// cleaning data for ChartJS\n}).catch(function(err){return alert(err);});case 6:_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error(_context2.t0.message);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function getDataCovid(){return _ref2.apply(this,arguments);};}();return{data:data,dataDiff:dataDiff,labels:labels,headers:headers,events:events,nextEvents:nextEvents,previousEvents:previousEvents,getDataCovid:getDataCovid,fetchEventsUrl:fetchEventsUrl,setEventUrl:setEventUrl,setNextEvents:setNextEvents,setPreviousEvents:setPreviousEvents};};export var StoreContainer=createContainer(useStore);","map":{"version":3,"sources":["/Users/rims/Documents/musicuizz/frontend/src/components/Store.tsx"],"names":["React","moment","_","createContainer","axios","useStore","useState","data","setData","dataDiff","setDataDiff","labels","setLabels","eventUrl","setEventUrl","events","setEvents","nextEvents","setNextEvents","previousEvents","setPreviousEvents","headers","Headers","fetchEventsUrl","url","get","response","meta","next","previous","console","log","countryDataGraph","country","caseType","dateTo","resultCases","resultDates","length","forEach","item","Date","isAfter","push","Cases","format","resultCasesDiff","map","e","i","pop","getDataCovid","subtract","fetch","method","redirect","then","json","res","catch","err","alert","error","message","StoreContainer"],"mappings":"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","sourcesContent":["// eslint-disable-next-line\nimport * as React from 'react';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport { createContainer } from \"unstated-next\";\nimport axios from 'axios';\n\n// const URL_PAGE = `https://api.turku.fi/linkedevents/v1/image/?page=`;\n// source : \"https://api.covid19api.com/\"\n\nexport const useStore = () => {\n  const [data, setData] = React.useState<Object[] | void | null | undefined>([]);// data for graph\n  const [dataDiff, setDataDiff] = React.useState<number[] | any[] | undefined>([]);// data diff for graph\n  const [labels, setLabels] = React.useState<Object[] | void | null | undefined>([]);\n  const [eventUrl, setEventUrl] = React.useState<string>(\"https://api.turku.fi/linkedevents/v1/event/?page=1\");\n  const [events, setEvents] = React.useState<any[]>([]);\n  const [nextEvents, setNextEvents] = React.useState<string>(\"\");\n  const [previousEvents, setPreviousEvents] = React.useState<string>(\"\");\n  const headers = new Headers({\n    \"Accept\": \"application/json\",\n    \"Content-Type\": \"application/json\",\n    \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:78.0) Gecko/20100101 Firefox/78.0\"\n  });\n\n  const fetchEventsUrl = async (url: any) => {\n    const response: any = await axios.get(url ? url : eventUrl);\n    setEvents(response.data.data);\n    if (response.data.meta.next)\n      setNextEvents(response.data.meta.next);\n    if (response.data.meta.previous)\n      setPreviousEvents(response.data.meta.previous);\n    console.log(\"Response events unstated\", response.data);\n    return response.data;\n  }\n\n  function countryDataGraph(data: any, country: string, caseType: string, dateTo: string) {\n    let resultCases: any[] = []\n    let resultDates: any[] = []\n    if (data.length > 0) {\n      data.forEach((item: any) => {\n        if ((moment(item.Date).isAfter(dateTo))) {\n          resultCases.push(item.Cases);\n          resultDates.push(moment(item.Date).format('YYYY/MM/DD'));\n        }\n      })\n      let resultCasesDiff: any[] = _.map(resultCases, function (e: any, i: any) {\n        return (resultCases[i + 1] - e) < 0 ? 0 : (resultCases[i + 1] - e)\n      });\n      resultCasesDiff.pop();\n      resultCases.pop();\n      resultDates.pop();\n      setDataDiff(resultCasesDiff);\n      setData(resultCases);\n      setLabels(resultDates);\n    }\n  }\n\n  // const response = await fetch(\"https://sampo.thl.fi/pivot/prod/en/epirapo/covid19case/fact_epirapo_covid19case.json\", {\n  const getDataCovid = async () => {\n    try {\n      const country: string = 'finland';\n      const caseType: string = 'confirmed';\n      const dateTo: string = `${moment().subtract(3, 'months').format()}`\n      await fetch(`https://api.covid19api.com/country/${country}/status/${caseType}/live?from=${dateTo}&to=${moment().format('YYYY-MM-DDT00:00:00')}`, {\n        method: 'GET',\n        redirect: 'follow',\n        headers: headers\n      })\n        .then((response: any) => response.json()).then((res) => {\n          countryDataGraph(res, country, caseType, dateTo);// cleaning data for ChartJS\n        }).catch(err => alert(err));\n    } catch (err) {\n      console.error(err.message);\n    }\n  }\n\n  return {\n    data,\n    dataDiff,\n    labels,\n    headers,\n    events,\n    nextEvents,\n    previousEvents,\n    getDataCovid,\n    fetchEventsUrl,\n    setEventUrl,\n    setNextEvents,\n    setPreviousEvents,\n  };\n}\nexport const StoreContainer = createContainer(useStore)\n"]},"metadata":{},"sourceType":"module"}